@using Domain.Interfaces
@using Domain.Models
@model IEnumerable<IItemValidating>

@{
    var typeRaw = (string?)ViewBag.Type ?? "restaurants";
    var type = typeRaw.ToLowerInvariant();

    bool showingRestaurants = type == "restaurants";
    bool showingMenu = type == "menu";

    // materialize once so we can call .Any() safely
    var items = Model?.ToList() ?? new List<IItemValidating>();
}

<h2>Catalog</h2>

<div class="mb-3">
    <!-- Toggle: Restaurants (cards) -->
    <a asp-action="Index"
       asp-route-type="restaurants"
       class="btn btn-sm @(showingRestaurants ? "btn-primary" : "btn-outline-primary")">
        Restaurants (card view)
    </a>

    <!-- Toggle: Menu items (list) -->
    <a asp-action="Index"
       asp-route-type="menu"
       class="btn btn-sm @(showingMenu ? "btn-primary" : "btn-outline-primary") ms-2">
        Menu items (list view)
    </a>
</div>

@if (!items.Any())
{
    <p>No items to display.</p>
}
else if (showingRestaurants)
{
    <!-- CARD VIEW for restaurants -->
    <div class="row">
        @foreach (var restaurant in items.OfType<Restaurant>())
        {
            <div class="col-md-3 mb-3">
                @await Html.PartialAsync("_RestaurantCard", restaurant)
            </div>
        }
    </div>
}
else if (showingMenu)
{
    <!-- LIST / ROW VIEW for menu items -->
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Image</th>
                <th>Title</th>
                <th>Price</th>
                <th>Restaurant</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in items.OfType<MenuItem>())
            {
                <tr>
                    <td style="width: 90px;">
                        @if (!string.IsNullOrWhiteSpace(item.ImagePath))
                        {
                            <img src="@item.ImagePath"
                                 alt="@item.Title"
                                 class="img-thumbnail"
                                 style="max-width:80px; max-height:80px;" />
                        }
                    </td>
                    <td>@item.Title</td>
                    <td>@item.Price.ToString("0.00")</td>
                    <td>@item.Restaurant?.Name</td>
                </tr>
            }
        </tbody>
    </table>
}
